<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Live Bus Tracker</title>
    <style>
        /* Added status colors */
        .progress-bar.delayed {
            background: #e74c3c;
        }
        .arrival-status {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Previous body content remains the same -->

    <script>
        // Modified renderServiceCards function
        function renderServiceCards(headers, data) {
            var container = document.getElementById('serviceContainer');
            container.innerHTML = '';

            var busNumberIndex = headers.indexOf('Bus Number');
            var operatorIndex = headers.indexOf('Bus Operator');
            
            for (var i = 0; i < data.length; i++) {
                var row = data[i];
                var serviceCard = document.createElement('div');
                serviceCard.className = 'service-card';
                
                var serviceNumber = row[busNumberIndex] || 'N/A';
                var operator = row[operatorIndex] || 'Unknown Operator';
                
                var buses = [];
                for (var busNum = 1; busNum <= 3; busNum++) {
                    var prefix = busNum + (busNum === 1 ? 'st' : busNum === 2 ? 'nd' : 'rd');
                    var arrival = row[headers.indexOf(prefix + ' Bus Arrival')];
                    if (!arrival || arrival === '') continue;

                    buses.push({
                        prefix: prefix,
                        arrival: arrival,
                        load: row[headers.indexOf(prefix + ' Bus Load')],
                        monitored: row[headers.indexOf(prefix + ' Bus Monitored')],
                        type: row[headers.indexOf(prefix + ' Bus Type')]
                    });
                }

                var busEntries = [];
                for (var b = 0; b < buses.length; b++) {
                    var bus = buses[b];
                    var isDelayed = bus.arrival === '-';
                    
                    var arrivalDisplay = isDelayed ? 
                        '<span class="arrival-status">Not Available</span>' : 
                        bus.arrival + ' min';
                    
                    var progressBar = isDelayed ? 
                        '<div class="progress-bar delayed" style="width: 100%"></div>' :
                        '<div class="progress-bar" style="width:' + 
                        Math.min(100, (30 - parseInt(bus.arrival || 0)) * 3.33) + '%"></div>';

                    busEntries.push(
                        '<div class="bus-entry">' +
                            '<div class="arrival-time">' + bus.prefix + ' Bus: ' + arrivalDisplay + '</div>' +
                            '<div class="progress-container">' + progressBar + '</div>' +
                            '<div class="bus-details">' +
                                'Load: ' + (bus.load === '-' ? 'N/A' : bus.load) + ' | ' +
                                'Monitored: ' + (bus.monitored === '-' ? 'No' : bus.monitored) + ' | ' +
                                'Type: ' + (bus.type === '-' ? 'Standard' : bus.type) +
                            '</div>' +
                        '</div>'
                    );
                }

                serviceCard.innerHTML = [
                    '<div class="service-header">',
                        '<span class="service-number">Service ' + serviceNumber + '</span>',
                        '<span class="operator">' + operator + '</span>',
                    '</div>',
                    busEntries.join('')
                ].join('');

                container.appendChild(serviceCard);
            }
        }

        /* Rest of the script remains unchanged */
    </script>
</body>
</html>

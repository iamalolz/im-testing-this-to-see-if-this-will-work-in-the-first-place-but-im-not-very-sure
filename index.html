<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Google Sheets Data Display</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Google Sheets Data</h1>
    <div id="sheetsData"></div>

    <script>
        // IE-compatible function to fetch and parse the Google Sheets data
        function fetchSheetsData() {
            var xhr = new XMLHttpRequest();
            var sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQtEvUyEWLCq8T0rFNBAEXi3HeQsLrR9PFmLbtRV4j8_lFKjF7D0St0QBFfpEx61XlWBUx0jQB0pgdF/pub?output=csv';
            
            xhr.open('GET', sheetUrl, true);
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            // Parse CSV data
                            var data = xhr.responseText;
                            var rows = data.split('\n');
                            var parsedRows = [];
                            
                            for (var i = 0; i < rows.length; i++) {
                                // Handle possible commas within quoted fields
                                var row = rows[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                                // Remove quotes from fields if present
                                for (var j = 0; j < row.length; j++) {
                                    if (row[j].charAt(0) === '"' && row[j].charAt(row[j].length - 1) === '"') {
                                        row[j] = row[j].substr(1, row[j].length - 2);
                                    }
                                }
                                parsedRows.push(row);
                            }

                            var headers = parsedRows[0];
                            var content = parsedRows.slice(1);

                            // Create table
                            var tableHtml = '<table><thead><tr>';
                            for (var i = 0; i < headers.length; i++) {
                                tableHtml += '<th>' + headers[i] + '</th>';
                            }
                            tableHtml += '</tr></thead><tbody>';

                            for (var i = 0; i < content.length; i++) {
                                tableHtml += '<tr>';
                                for (var j = 0; j < content[i].length; j++) {
                                    tableHtml += '<td>' + content[i][j] + '</td>';
                                }
                                tableHtml += '</tr>';
                            }

                            tableHtml += '</tbody></table>';

                            // Display the table
                            document.getElementById('sheetsData').innerHTML = tableHtml;

                            // Make data available globally for parsing
                            window.sheetsData = parsedRows;
                        } catch (error) {
                            document.getElementById('sheetsData').innerHTML = 'Error parsing data: ' + error.message;
                        }
                    } else {
                        document.getElementById('sheetsData').innerHTML = 'Error loading data. Status: ' + xhr.status;
                    }
                }
            };

            xhr.onerror = function() {
                document.getElementById('sheetsData').innerHTML = 'Error loading data. Please check your connection.';
            };

            try {
                xhr.send();
            } catch (error) {
                document.getElementById('sheetsData').innerHTML = 'Error sending request: ' + error.message;
            }
        }

        // Helper function for IE compatibility
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload !== 'function') {
                window.onload = func;
            } else {
                window.onload = function() {
                    if (oldonload) {
                        oldonload();
                    }
                    func();
                };
            }
        }

        // Load data when page loads
        addLoadEvent(fetchSheetsData);
    </script>
</body>
</html>
